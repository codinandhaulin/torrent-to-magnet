<!DOCTYPE html>
<html>
<head>
  <title>.torrent to Magnet Generator</title>
</head>
<body>
  <h1>.torrent to Magnet File Converter</h1>
  <input type="text" id="torrentUrl" placeholder="Paste .torrent file URL here" style="width: 400px;"><br><br>
  <input type="text" id="user" placeholder="Username (if needed)">
  <input type="password" id="pass" placeholder="Password (if needed)"><br><br>
  <button onclick="convertTorrent()">Convert & Download Magnet</button>
  <script src="https://unpkg.com/bencode@2.1.3/lib/bencode.js"></script>
  <script>
    async function convertTorrent() {
      const url = document.getElementById('torrentUrl').value.trim();
      const user = document.getElementById('user').value;
      const pass = document.getElementById('pass').value;
      if (!url) return alert("Please enter a .torrent file URL!");

      // Point to your backend (use localhost for testing, or deployed service URL)
      const backend = 'https://torrent-to-magnet-1.onrender.com//fetch-torrent';

      const params = new URLSearchParams();
      params.append('url', url);
      if (user) params.append('user', user);
      if (pass) params.append('pass', pass);

      try {
        const response = await fetch(`${backend}?${params.toString()}`);
        if (!response.ok) throw new Error("Failed to fetch torrent (" + response.status + ")");
        const arrayBuffer = await response.arrayBuffer();
        const torrent = bencode.decode(new Uint8Array(arrayBuffer));

        // ... (rest of magnet creation and download code remains unchanged)
        const info = torrent.info;
        const infoEncoded = bencode.encode(info);
        const infoHashBuffer = await crypto.subtle.digest('SHA-1', infoEncoded);
        const infoHash = Array.from(new Uint8Array(infoHashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
        const name = info['name'] ? (typeof info['name'] === 'string' ? info['name'] : new TextDecoder().decode(info['name'])) : "magnet";
        let trackers = [];
        if (torrent['announce']) {
          trackers.push(typeof torrent['announce'] === 'string' ? torrent['announce'] : new TextDecoder().decode(torrent['announce']));
        }
        if (torrent['announce-list']) {
          trackers = trackers.concat(torrent['announce-list'].flat().map(tr => typeof tr === 'string' ? tr : new TextDecoder().decode(tr)));
        }
        let magnet = `magnet:?xt=urn:btih:${infoHash}`;
        magnet += `&dn=${encodeURIComponent(name)}`;
        trackers.forEach(tr => {
          if (tr) magnet += `&tr=${encodeURIComponent(tr)}`;
        });
        const blob = new Blob([magnet], {type: "text/plain"});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${name}.magnet`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      } catch (e) {
        alert("Error: " + e);
      }
    }
  </script>
</body>
</html>
